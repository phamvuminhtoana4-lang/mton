<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Shop Acc Toàn</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;font-family:Arial;background:#020617;color:#fff}
header{padding:10px;display:flex;align-items:center;gap:10px}
#menuBtn{font-size:22px;cursor:pointer}
#userInfo{margin-left:auto}
#side{position:fixed;left:-260px;top:0;width:250px;height:100%;background:#020617;padding:15px;transition:.3s}
#side a{display:block;padding:10px;border-bottom:1px solid #1e293b;cursor:pointer}
.container{padding:15px}
.card{border:1px solid #1e293b;border-radius:10px;padding:12px;margin-bottom:12px}
input,textarea,select{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:none}
button{padding:8px;border:none;border-radius:6px;background:#fde047;font-weight:bold}
.view{display:none}
.view.active{display:block}
.small{font-size:13px;color:#cbd5f5}
</style>
</head>
<body>

<header>
<span id="menuBtn" onclick="toggle()">☰</span>
<b>SHOP ACC TOÀN</b>
<div id="userInfo">Chưa đăng nhập</div>
</header>

<div id="side">
<a onclick="go('home')">Trang chính</a>
<a onclick="go('nap')">Nạp tiền</a>
<a onclick="go('shop')">Shop acc</a>
<a onclick="go('hisNap')">Lịch sử nạp</a>
<a onclick="go('hisBuy')">Lịch sử mua</a>
<a id="adminLink" onclick="go('admin')" style="display:none">ADMIN</a>
<a onclick="logout()">Đăng xuất</a>
</div>

<div class="container">

<!-- HOME -->
<div id="home" class="view active">
<div class="card">
<h3>Đăng nhập / Đăng ký</h3>
<input id="u" placeholder="Tài khoản">
<input id="p" type="password" placeholder="Mật khẩu">
<button onclick="login()">Đăng nhập</button>
<button onclick="register()">Đăng ký</button>
</div>
</div>

<!-- NẠP -->
<div id="nap" class="view">
<div class="card">
<h3>Nạp thẻ</h3>
<select id="val">
<option>50000</option>
<option>100000</option>
<option>200000</option>
<option>500000</option>
</select>
<input id="code" placeholder="Mã thẻ">
<input id="seri" placeholder="Seri">
<button onclick="sendCard()">Gửi thẻ</button>
</div>
</div>

<!-- SHOP -->
<div id="shop" class="view"><div id="accList"></div></div>

<!-- HISTORY -->
<div id="hisNap" class="view"><div id="napList"></div></div>
<div id="hisBuy" class="view"><div id="buyList"></div></div>

<!-- ADMIN -->
<div id="admin" class="view">

<div class="card">
<h3>Duyệt nạp</h3>
<div id="pendingNap"></div>
</div>

<div class="card">
<h3>Up acc mới</h3>
<input id="an" placeholder="Tên acc">
<input id="au" placeholder="Tài khoản acc">
<input id="ap" placeholder="Mật khẩu acc">
<input id="ag" placeholder="Giá">
<textarea id="anote" placeholder="Ghi chú acc (rank, skin, lưu ý...)"></textarea>
<button onclick="addAcc()">Thêm acc</button>
</div>

<div class="card">
<h3>Duyệt mua acc</h3>
<div id="pendingBuy"></div>
</div>

</div>
</div>

<script>
const ADMIN="admin",PASS="Pvmt207#";
let users=JSON.parse(localStorage.users||"{}");
let accs=JSON.parse(localStorage.accs||"[]");
let nap=JSON.parse(localStorage.nap||"[]");
let buy=JSON.parse(localStorage.buy||"[]");
let cur=null,isAdmin=false;

function toggle(){side.style.left=side.style.left=="0px"?"-260px":"0px"}
function go(v){
 if(!cur && v!=="home")return alert("Đăng nhập trước");
 document.querySelectorAll('.view').forEach(x=>x.classList.remove("active"));
 document.getElementById(v).classList.add("active");
 if(v=="shop")renderShop();
 if(v=="hisNap")renderNap();
 if(v=="hisBuy")renderBuy();
 if(v=="admin")renderAdmin();
 side.style.left="-260px";
}

function register(){
 if(users[u.value])return alert("Tồn tại");
 users[u.value]={pass:p.value,b:0};
 localStorage.users=JSON.stringify(users);
 alert("Đăng ký thành công");
}

function login(){
 if(u.value==ADMIN && p.value==PASS){
  cur="ADMIN";isAdmin=true;
  adminLink.style.display="block";
  userInfo.innerText="ADMIN";
  go("admin");return;
 }
 if(!users[u.value]||users[u.value].pass!=p.value)return alert("Sai thông tin");
 cur=u.value;
 userInfo.innerText=cur+" | "+users[cur].b+"đ";
 go("nap");
}

function logout(){location.reload()}

function sendCard(){
 nap.push({u:cur,v:val.value,c:code.value,s:seri.value,st:"Chờ duyệt"});
 localStorage.nap=JSON.stringify(nap);
 alert("Đã gửi thẻ");
}

function renderNap(){
 napList.innerHTML="";
 nap.filter(x=>x.u==cur).forEach(x=>{
  napList.innerHTML+=`
  <div class="card">${x.v}đ - <b>${x.st}</b></div>`;
 });
}

function addAcc(){
 accs.push({
  n:an.value,
  u:au.value,
  p:ap.value,
  g:ag.value,
  note:anote.value
 });
 localStorage.accs=JSON.stringify(accs);
 alert("Đã thêm acc");
}

function renderShop(){
 accList.innerHTML="";
 accs.forEach((a,i)=>{
  accList.innerHTML+=`
  <div class="card">
   <b>${a.n}</b><br>
   Giá: ${a.g}đ<br>
   <span class="small">Ghi chú: ${a.note||"Không có"}</span><br>
   <button onclick="buyAcc(${i})">Mua</button>
  </div>`;
 });
}

function buyAcc(i){
 if(users[cur].b<accs[i].g)return alert("Không đủ tiền");
 users[cur].b-=accs[i].g;
 buy.push({u:cur,i:i,st:"Chờ giao"});
 localStorage.buy=JSON.stringify(buy);
 localStorage.users=JSON.stringify(users);
 alert("Đã mua, chờ giao acc");
}

function renderBuy(){
 buyList.innerHTML="";
 buy.filter(x=>x.u==cur).forEach(x=>{
  let a=accs[x.i];
  buyList.innerHTML+=`
  <div class="card">
   ${a.n} - <b>${x.st}</b>
   ${x.st=="Thành công" ? `
   <hr>
   TK: ${a.u}<br>
   MK: ${a.p}<br>
   Ghi chú: ${a.note||"Không có"}
   ` : ""}
  </div>`;
 });
}

function renderAdmin(){
 pendingNap.innerHTML="";
 nap.forEach((x,i)=>{
  pendingNap.innerHTML+=`
  <div class="card">
   ${x.u} - ${x.v}đ - ${x.st}
   <button onclick="approveNap(${i})">Duyệt</button>
   <button onclick="rejectNap(${i})">Sai</button>
  </div>`;
 });
 pendingBuy.innerHTML="";
 buy.forEach((x,i)=>{
  pendingBuy.innerHTML+=`
  <div class="card">
   ${x.u} mua acc
   <button onclick="approveBuy(${i})">Giao acc</button>
  </div>`;
 });
}

function approveNap(i){
 nap[i].st="Đã duyệt";
 users[nap[i].u].b+=Number(nap[i].v);
 localStorage.users=JSON.stringify(users);
 localStorage.nap=JSON.stringify(nap);
 renderAdmin();
}

function rejectNap(i){
 nap[i].st="Sai mã";
 localStorage.nap=JSON.stringify(nap);
 renderAdmin();
}

function approveBuy(i){
 buy[i].st="Thành công";
 localStorage.buy=JSON.stringify(buy);
 renderAdmin();
}
</script>

</body>
</html>
